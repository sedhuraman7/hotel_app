{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/hotal_project/web_app/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst prismaClientSingleton = () => {\r\n    return new PrismaClient();\r\n};\r\n\r\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>;\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n    prisma: PrismaClientSingleton | undefined;\r\n};\r\n\r\nexport const prisma = globalForPrisma.prisma ?? prismaClientSingleton();\r\n\r\nif (process.env.NODE_ENV !== 'production') {\r\n    globalForPrisma.prisma = prisma;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,sMAAY;AAC3B;AAIA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C;IACvC,gBAAgB,MAAM,GAAG;AAC7B"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///D:/hotal_project/web_app/app/api/guests/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\n// POST: Check In Guest\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const body = await req.json();\r\n        // body: { name, roomId, cardId, phone, paymentStatus, totalAmount }\r\n\r\n        const { name, roomId, cardId, phone, paymentStatus, totalAmount } = body;\r\n\r\n        // 1. Check if Room is Vacant\r\n        const room = await prisma.room.findUnique({ where: { id: roomId } });\r\n        if (!room) return NextResponse.json({ error: \"Room not found\" }, { status: 404 });\r\n        if (room.status !== \"Vacant\") return NextResponse.json({ error: \"Room is not vacant\" }, { status: 400 });\r\n\r\n        // 2. Create Guest Record\r\n        const guest = await prisma.guest.create({\r\n            data: {\r\n                name,\r\n                roomId,\r\n                rfidCardId: cardId, // Optional\r\n                paymentStatus,\r\n                totalAmount: parseFloat(totalAmount),\r\n                status: \"Checked In\",\r\n                currentRoomId: roomId // Bind as active guest\r\n            }\r\n        });\r\n\r\n        // 3. Update Room Status\r\n        await prisma.room.update({\r\n            where: { id: roomId },\r\n            data: { status: \"Occupied\" }\r\n        });\r\n\r\n        return NextResponse.json(guest);\r\n\r\n    } catch (error) {\r\n        console.error(\"Check-in Error:\", error);\r\n        return NextResponse.json({ error: \"Check-in failed\" }, { status: 500 });\r\n    }\r\n}\r\n\r\n// GET: List Guests (Active & History)\r\nexport async function GET(req: NextRequest) {\r\n    try {\r\n        const guests = await prisma.guest.findMany({\r\n            orderBy: { checkInTime: 'desc' },\r\n            include: { room: true }\r\n        });\r\n        return NextResponse.json(guests);\r\n    } catch (error) {\r\n        return NextResponse.json({ error: \"Failed to fetch guests\" }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,oEAAoE;QAEpE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,aAAa,EAAE,WAAW,EAAE,GAAG;QAEpE,6BAA6B;QAC7B,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI;YAAO;QAAE;QAClE,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;QAC/E,IAAI,KAAK,MAAM,KAAK,UAAU,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;QAEtG,yBAAyB;QACzB,MAAM,QAAQ,MAAM,yHAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACpC,MAAM;gBACF;gBACA;gBACA,YAAY;gBACZ;gBACA,aAAa,WAAW;gBACxB,QAAQ;gBACR,eAAe,OAAO,uBAAuB;YACjD;QACJ;QAEA,wBAAwB;QACxB,MAAM,yHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACrB,OAAO;gBAAE,IAAI;YAAO;YACpB,MAAM;gBAAE,QAAQ;YAAW;QAC/B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAE7B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;IACzE;AACJ;AAGO,eAAe,IAAI,GAAgB;IACtC,IAAI;QACA,MAAM,SAAS,MAAM,yHAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YACvC,SAAS;gBAAE,aAAa;YAAO;YAC/B,SAAS;gBAAE,MAAM;YAAK;QAC1B;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAChF;AACJ"}}]
}